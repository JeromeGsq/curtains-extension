let n={};chrome.storage.local.get(["blockedDomains"],t=>{n=t.blockedDomains||{}});function u(t){try{return new URL(t).hostname}catch{return null}}function m(){chrome.storage.local.set({blockedDomains:n})}chrome.runtime.onMessage.addListener((t,e,i)=>{if(t.action==="setState"){const o=e.tab?.url||t.url,r=e.tab?.id,c=u(o);c&&(n[c]=t.state,m(),r&&t.mute!==void 0&&chrome.tabs.update(r,{muted:t.mute}),chrome.tabs.query({},l=>{l.forEach(a=>{a.id&&a.id!==r&&a.url&&u(a.url)===c&&chrome.tabs.sendMessage(a.id,{action:"updateState",state:t.state}).catch(()=>{})})}),i({success:!0}))}else if(t.action==="getState"){const o=e.tab?.url||t.url,r=u(o);if(r){const c=n[r]||!1;i({state:c})}else i({state:!1})}else if(t.action==="getTheme")return chrome.storage.local.get(["themePreference"],o=>{i({theme:o.themePreference||"system"})}),!0;return!0});chrome.commands.onCommand.addListener(t=>{t==="toggle-curtain"&&chrome.tabs.query({active:!0,currentWindow:!0},e=>{e[0]?.id&&chrome.tabs.sendMessage(e[0].id,{action:"toggleCurtain"})})});
